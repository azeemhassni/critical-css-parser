var e=function(e,r){try{return Promise.resolve(e.$$eval("body *:not(script):not(style)",function(e,r){Array.from(e).forEach(function(e){if(e.getBoundingClientRect().top+pageYOffset>r)try{e.remove()}catch(e){console.log(e)}})},r)).then(function(){return Promise.resolve(e.content())})}catch(e){return Promise.reject(e)}},r=require("http-server"),t=require("puppeteer"),n=require("dropcss"),o=require("axios").get;function i(e,r,t,o,i){var s=n({html:e,css:t,shouldDrop:function(e){return!o.test(e)}}),u=n({html:r,css:t,shouldDrop:function(e){return!o.test(e)}}),l=new Set;s.sels.forEach(function(e){return l.add(e)}),u.sels.forEach(function(e){return l.add(e)});var c=n({html:"",css:t,shouldDrop:function(e){return!l.has(e)}}),a=n({html:"",css:t,shouldDrop:function(e){return l.has(e)}});if(i){var h=require("csso");c.css=h.minify(c.css).css,a.css=h.minify(a.css).css}return{critical:c.css,rest:a.css}}module.exports=function(n){try{return Promise.resolve(function(){if("HTML"===n.type){var s=n.html;void 0===s&&(s="");var u=n.css;void 0===u&&(u="");var l=n.whitelist;void 0===l&&(l=/#fooBazBarAboveTheFold8917/);var c=n.minify;return void 0===c&&(c=!1),Promise.resolve(t.launch({args:n.puppeteerArgs})).then(function(r){return Promise.resolve(r.newPage()).then(function(t){return Promise.resolve(t.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(t.setContent(s,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(t.addStyleTag({content:u})).then(function(){return Promise.resolve(t.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(r.newPage()).then(function(n){return Promise.resolve(n.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(n.setContent(s,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(n.addStyleTag({content:u})).then(function(){return Promise.resolve(n.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(t,1200)).then(function(t){return Promise.resolve(e(n,650)).then(function(e){return Promise.resolve(r.close()).then(function(){return i(t,e,u,l,c)})})})})})})})})})})})})})})}return function(){if("URL"===n.type){var s=n.URL;void 0===s&&(s="");var u=n.enableGoogleFonts;void 0===u&&(u=0);var l=n.whitelist;void 0===l&&(l=/#fooBazBarAboveTheFold8917/);var c=n.minify;return void 0===c&&(c=!1),Promise.resolve(t.launch({args:n.puppeteerArgs})).then(function(r){return Promise.resolve(r.newPage()).then(function(t){return Promise.resolve(t.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(t.goto(s,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(t.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(t.$$eval("link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(n){return u||(n=n.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(r.newPage()).then(function(u){return Promise.resolve(u.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(u.goto(s,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(u.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(t,1200)).then(function(t){return Promise.resolve(e(u,650)).then(function(e){return Promise.resolve(r.close()).then(function(){var r="";return Promise.resolve(Promise.all(n.map(function(e){try{return Promise.resolve(o(e)).then(function(e){r+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){return i(t,e,r,l,c)})})})})})})})})})})})})})})}return function(){if("localServer"===n.type){var s=n.entrypoint;void 0===s&&(s="");var u=n.filename;void 0===u&&(u="index.html");var l=n.enableGoogleFonts;void 0===l&&(l=0);var c=n.whitelist;void 0===c&&(c=/#fooBazBarAboveTheFold8917/);var a=n.minify;void 0===a&&(a=!1);var h=r.createServer({root:s});return h.listen(6543),Promise.resolve(t.launch({args:n.puppeteerArgs})).then(function(r){return Promise.resolve(r.newPage()).then(function(t){return Promise.resolve(t.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(t.goto("http://127.0.0.1:6543/"+u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(t.setViewport({width:1920,height:1200})).then(function(){return Promise.resolve(t.$$eval("link[rel=stylesheet]",function(e){return Array.from(e).map(function(e){return e.href})})).then(function(n){return l||(n=n.filter(function(e){return-1===e.indexOf("fonts.googleapis.com")})),Promise.resolve(r.newPage()).then(function(s){return Promise.resolve(s.setDefaultNavigationTimeout(6e4)).then(function(){return Promise.resolve(s.goto("http://127.0.0.1:6543/"+u,{waitUntil:"networkidle2"})).then(function(){return Promise.resolve(s.setViewport({width:480,height:650,isMobile:!0,hasTouch:!0})).then(function(){return Promise.resolve(e(t,1200)).then(function(t){return Promise.resolve(e(s,650)).then(function(e){return Promise.resolve(r.close()).then(function(){var r="";return Promise.resolve(Promise.all(n.map(function(e){try{return Promise.resolve(o(e)).then(function(e){r+=e.data})}catch(e){return Promise.reject(e)}}))).then(function(){return h.close(),i(t,e,r,c,a)})})})})})})})})})})})})})})}}()}()}())}catch(e){return Promise.reject(e)}};
//# sourceMappingURL=index.mjs.map
